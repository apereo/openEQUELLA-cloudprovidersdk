# Registering your Cloud Provider with openEQUELLA

In order to run a cloud provider service you must provide a web page which can accept a cloud provider registration request. This is the URL that openEQUELLA administrators will enter as the registration URL. Let's use a server running on localhost as an example:

`http://localhost:8080/index.html`

This page is where you should authenticate that the user has access to your cloud provider service and if so can register with the openEQUELLA that initiated the registration request.

In order to complete the registration you should use the two parameters generated by openEQUELLA and appended to your registration web page URL:

- `institution` - The institution URL requesting the registration.
- `register` - An opaque institution relative URI which you must POST a cloud provider JSON registration to. This URL can only be used once and will expire within an hour.

An example URL initial URL would be:

`http://localhost:8080/index.html?institution=http://equella.com/inst/&register=api/cloudprovider/register%3Ftoken=TOKENVALUE`

Which would mean you should POST your registration to:

`http://equella.com/inst/api/cloudprovider/register?token=TOKENVALUE`

If your registration is successful you will receive a JSON registration response (`ProviderRegistrationResponse`) which contains:

- The full cloud provider registration JSON, which will include the "provider id" and oauth credentials for authenticating into the openEQUELLA instance.
- A forward URL to redirect the browser back into openEQUELLA.

# Cloud Provider Registration data

The format of the registration JSON is available in a typescript defintion file [here](../registration.d.ts) (`ProviderRegistration`).

```json
{
  "name": "My Cloud Provider",
  "description": "My sample cloud provider, including wizard controls",
  "vendorId": "myvendor",
  "baseUrl": "http://localhost:5000/",
  "iconUrl": "https://user-images.githubusercontent.com/4625498/55527161-8591ca80-56e3-11e9-8865-ca7c3bc5b7f2.gif",
  "providerAuth": {
    "clientId": "universityid",
    "clientSecret": "universitysecret"
  },
  "serviceUris": {
    "oauth": {
      "uri": "${baseurl}oauthtoken",
      "authenticated": false
    },
    "refresh": {
      "uri": "${baseurl}refresh",
      "authenticated": false
    },
    "controls": {
      "uri": "${baseurl}controls",
      "authenticated": false
    },
    "control_omdb": {
      "uri": "${baseurl}omdb.js",
      "authenticated": false
    }
  },
  "viewers": {
    "myattachment": {
      "": {
        "name": "Default viewer",
        "serviceId": "viewattachment"
      }
    }
  }
}
```
